(load "main.scm")

(use-modules (oop goops)
             (oop goops describe))

(define rng (new-gsl-rng (gsl-rng-default)))
(define x (new-gv 1))
(define s (mcmclib-gauss-am-alloc
	   rng
	   (lambda (x) 0.0)
	   x
	   (sm->gm #2((1.0)))
	   10))
;; this should stop on values divergence:
(pass-if-exception "stop on divergence" exception:miscellaneous-error
		   (do-ec (: i 100000) (mcmclib-amh-update s)))

(define s (make-mh 'gauss-mrw
                    (new-gsl-rng (gsl-rng-default))
                    (lambda (x) 0.0)
                    (new-gv 1)
                    (sm->gm #2((1.0)))))
(do-ec (: i 100000) (update s)) ;;this should not stop
(format #t "~a\n" (gv->sv (slot-ref s 'x)))
